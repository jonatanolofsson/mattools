%% Export figure to pdf
% Creates a pdf with the plots from the figure handles in the first
% argument.
%
%%% Input arguments:
%	figs			- Figures to export to pdf, as a cell array
%
%	filename		- Name of the pdf output file
%
%%% Output arguments:
%	[ none ]
%
%%% Credits and history
% By:	Jonatan Olofsson		joolo/jooln			2010-07
%
% Changelog:
%	[ none ]
%
function topdf(figs, filename)
	mdir = [regexprep(fileparts(mfilename('fullpath')), '/\\$', '') '/'];
	if ispc
		gs = ['"' mdir 'gs/gswin32c.exe"'];
	elseif isunix
		gs = 'gs';
	end
	
	files = cell(3, length(figs));
    
    if isempty(figs), figs = struct2cell(figures.created_figures); end;
	
	for f=1:length(figs)
		files(:,f) = {'"'; [mdir 'work/fig2pdftmp__' num2str(f) '__.ps']; '" '};
        if is_integer(figs{f})
            cfigure = figs{f};
        else
            cfigure = figures.get_figure(figs{f});
        end
		saveas(cfigure, files{2,f}, 'psc2');
	end
	
	args = ['-q -dNOPAUSE -dSAFER -sOutputFile="' filename '" -sDEVICE=pdfwrite -sPAPERSIZE=a4 -dBATCH'];
	
	dos([gs ' ' args ' -f ' files{:}]);
	delete([mdir 'work/fig2pdftmp__*__.ps']);
end